<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>2.5.2 Some Special Methods Don't Work</title>
<META NAME="description" CONTENT="2.5.2 Some Special Methods Don't Work">
<META NAME="keywords" CONTENT="zodb">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="STYLESHEET" href="zodb.css" type='text/css'>
<link rel="first" href="zodb.html">
<link rel="contents" href="contents.html" title="Contents">

<LINK REL="next" HREF="node18.html">
<LINK REL="previous" HREF="node16.html">
<LINK REL="up" HREF="node15.html">
<LINK REL="next" HREF="node18.html">
<meta name='aesop' content='information'>
</head>
<body>
<DIV CLASS="navigation">
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td><A HREF="node16.html"><img src="/python/writing/icons/previous.gif"
  border="0" height="32"
  alt="Previous Page" width="32"></A></td>
<td><A HREF="node15.html"><img src="/python/writing/icons/up.gif"
  border="0" height="32"
  alt="Up One Level" width="32"></A></td>
<td><A HREF="node18.html"><img src="/python/writing/icons/next.gif"
  border="0" height="32"
  alt="Next Page" width="32"></A></td>
<td align="center" width="100%">ZODB/ZEO Programming Guide</td>
<td><A href="contents.html"><img src="/python/writing/icons/contents.gif"
  border="0" height="32"
  alt="Contents" width="32"></A></td>
<td><img src="/python/writing/icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
<td><img src="/python/writing/icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
</tr></table>
<b class="navlabel">Previous:</b> <a class="sectref" HREF="node16.html">2.5.1 Modifying Mutable Objects</A>
<b class="navlabel">Up:</b> <a class="sectref" HREF="node15.html">2.5 Rules for Writing</A>
<b class="navlabel">Next:</b> <a class="sectref" HREF="node18.html">2.5.3 __getattr__, __delattr__, and</A>
<br><hr>
</DIV>
<!--End of Navigation Panel-->

<H3><A NAME="SECTION000352000000000000000">
2.5.2 Some Special Methods Don't Work</A>
</H3>

<P>
Don't bother defining certain special methods on
ExtensionClasses, because they won't work.  Most notably, the
<tt class="method">__cmp__</tt> method on an ExtensionClass will never be called.
Neither will the reversed versions of binary arithmetic operations,
such as <tt class="method">__radd__</tt> and <tt class="method">__rsub__</tt>.

<P>
This is a moderately annoying limitation.  It means that the
<tt class="class">PersistentList</tt> class can't implement comparisons with regular
sequence objects, and therefore statements such as 
<code>if perslist==[]</code> don't do what you expect; instead of performing the correct
comparison, they return some arbitrary fixed result, so the <code>if</code>
statement will always be true or always be false.  There is no good
solution to this problem at the moment, so all you can do is design
class interfaces that don't need to overload
<tt class="method">__cmp__</tt> or the <tt class="method">__r*__</tt> methods.

<P>
This limitation is mostly Python's fault.  As of Python 2.1, the most
recent version at this writing, the code which handles comparing two
Python objects contains a hard-wired check for objects that are class
instances, which means that <code>type(obj) == types.InstanceType</code>.
The code inside the Python interpreter looks like this:

<P>
<div class="verbatim"><pre>
/* Code to compare objects v and w */
if (PyInstance_Check(v) || PyInstance_Check(w))
        return PyInstance_DoBinOp(v, w, "__cmp__", "__rcmp__", do_cmp);
/* Do usual Python comparison of v,w */
c = PyObject_Compare(v, w);
</pre></div>

<P>
While ExtensionClasses try to behave as much like regular Python
instances as possible, they are still not instances, and
<tt class="function">type()</tt> doesn't return the <code>InstanceType</code> object, so 
no attempt is ever made to call <tt class="method">__cmp__</tt>.  Perhaps Python 2.2
will repair this.

<P>

<DIV CLASS="navigation">
<p><hr>
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td><A HREF="node16.html"><img src="/python/writing/icons/previous.gif"
  border="0" height="32"
  alt="Previous Page" width="32"></A></td>
<td><A HREF="node15.html"><img src="/python/writing/icons/up.gif"
  border="0" height="32"
  alt="Up One Level" width="32"></A></td>
<td><A HREF="node18.html"><img src="/python/writing/icons/next.gif"
  border="0" height="32"
  alt="Next Page" width="32"></A></td>
<td align="center" width="100%">ZODB/ZEO Programming Guide</td>
<td><A href="contents.html"><img src="/python/writing/icons/contents.gif"
  border="0" height="32"
  alt="Contents" width="32"></A></td>
<td><img src="/python/writing/icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
<td><img src="/python/writing/icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
</tr></table>
<b class="navlabel">Previous:</b> <a class="sectref" HREF="node16.html">2.5.1 Modifying Mutable Objects</A>
<b class="navlabel">Up:</b> <a class="sectref" HREF="node15.html">2.5 Rules for Writing</A>
<b class="navlabel">Next:</b> <a class="sectref" HREF="node18.html">2.5.3 __getattr__, __delattr__, and</A>
<hr>
<span class="release-info">Release 0.04, documentation updated on October 4, 2002.</span>
</DIV>
<!--End of Navigation Panel-->

</BODY>
</HTML>
