<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>4.3 Versions</title>
<META NAME="description" CONTENT="4.3 Versions">
<META NAME="keywords" CONTENT="zodb">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<meta http-equiv="Content-Type" content="text/html; charset=">
<link rel="STYLESHEET" href="zodb.css">
<link rel="first" href="zodb.html">
<link rel="contents" href="contents.html" title="Contents">

<LINK REL="next" HREF="node35.html">
<LINK REL="previous" HREF="node33.html">
<LINK REL="up" HREF="node31.html">
<LINK REL="next" HREF="node35.html">
</head>
<body>
<DIV CLASS="navigation">
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td><A HREF="node33.html"><img src="/python/writing/icons/previous.gif"
  border="0" height="32"
  alt="Previous Page" width="32"></A></td>
<td><A HREF="node31.html"><img src="/python/writing/icons/up.gif"
  border="0" height="32"
  alt="Up One Level" width="32"></A></td>
<td><A HREF="node35.html"><img src="/python/writing/icons/next.gif"
  border="0" height="32"
  alt="Next Page" width="32"></A></td>
<td align="center" width="100%">ZODB/ZEO Programming Guide</td>
<td><A href="contents.html"><img src="/python/writing/icons/contents.gif"
  border="0" height="32"
  alt="Contents" width="32"></A></td>
<td><img src="/python/writing/icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
<td><img src="/python/writing/icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
</tr></table>
<b class="navlabel">Previous:</b> <a class="sectref" HREF="node33.html">4.2 Undoing Changes</A>
<b class="navlabel">Up:</b> <a class="sectref" HREF="node31.html">4 Transactions and Versioning</A>
<b class="navlabel">Next:</b> <a class="sectref" HREF="node35.html">4.4 Multithreaded ZODB Programs</A>
<br><hr>
</DIV>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION000530000000000000000">
4.3 Versions</A>
</H2>

<P>
While many subtransactions can be contained within a single regular
transaction, it's also possible to contain many regular transactions
within a long-running transaction, called a version in ZODB
terminology.  Inside a version, any number of transactions can be
created and committed or rolled back, but the changes within a version
are not made visible to other connections to the same ZODB.

<P>
Not all storages support versions, but you can test for versioning
ability by calling <tt class="method">supportsVersions()</tt> method of the
<tt class="class">DB</tt> instance, which returns true if the underlying storage
supports versioning.

<P>
A version can be selected when creating the <tt class="class">Connection</tt>
instance using the <tt class="method">DB.open(<big>[</big><var>version</var><big>]</big>)</tt> method.
The <var>version</var> argument must be a string that will be used as the
name of the version.

<P>
<dl><dd><pre class="verbatim">
vers_conn = db.open(version='Working version')
</pre></dl>

<P>
Transactions can then be committed and aborted using this versioned
connection.  Other connections that don't specify a version, or
provide a different version name, will not see changes committed
within the version named "<tt class="samp">Working&nbsp;version</tt>".  To commit or abort a
version, which will either make the changes visible to all clients or
roll them back, call the <tt class="method">DB.commitVersion()</tt> or
<tt class="method">DB.abortVersion()</tt> methods.
XXX what are the source and dest arguments for?

<P>
The ZODB makes no attempt to reconcile changes between different
versions.  Instead, the first version which modifies an object will
gain a lock on that object.  Attempting to modify the object from a
different version or from an unversioned connection will cause a
<tt class="exception">ZODB.POSException.VersionLockError</tt> to be raised:

<P>
<dl><dd><pre class="verbatim">
from ZODB.POSException import VersionLockError

try:
    get_transaction().commit()
except VersionLockError, (obj_id, version):
    print ('Cannot commit; object %s '
           'locked by version %s' % (obj_id, version))
</pre></dl>

<P>
The exception provides the ID of the locked object, and the name of
the version having a lock on it.

<P>

<DIV CLASS="navigation">
<p><hr>
<table align="center" width="100%" cellpadding="0" cellspacing="2">
<tr>
<td><A HREF="node33.html"><img src="/python/writing/icons/previous.gif"
  border="0" height="32"
  alt="Previous Page" width="32"></A></td>
<td><A HREF="node31.html"><img src="/python/writing/icons/up.gif"
  border="0" height="32"
  alt="Up One Level" width="32"></A></td>
<td><A HREF="node35.html"><img src="/python/writing/icons/next.gif"
  border="0" height="32"
  alt="Next Page" width="32"></A></td>
<td align="center" width="100%">ZODB/ZEO Programming Guide</td>
<td><A href="contents.html"><img src="/python/writing/icons/contents.gif"
  border="0" height="32"
  alt="Contents" width="32"></A></td>
<td><img src="/python/writing/icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
<td><img src="/python/writing/icons/blank.gif"
  border="0" height="32"
  alt="" width="32"></td>
</tr></table>
<b class="navlabel">Previous:</b> <a class="sectref" HREF="node33.html">4.2 Undoing Changes</A>
<b class="navlabel">Up:</b> <a class="sectref" HREF="node31.html">4 Transactions and Versioning</A>
<b class="navlabel">Next:</b> <a class="sectref" HREF="node35.html">4.4 Multithreaded ZODB Programs</A>
<hr>
<span class="release-info">Release 0.03, documentation updated on February 8, 2002.</span>
</DIV>
<!--End of Navigation Panel-->

</BODY>
</HTML>
