<div id="image-tool-target">

</div>

<input tal:replace="structure view/inputField" />

<script type="text/javascript" tal:content='string: 
function encodeForFlash(str) {
  str=str.split("+").join("[p]");
	str=str.split("=").join("[e]");
	return str;
}

function cropImage(crop_x, crop_y, crop_w, crop_h, size_w, size_h, rotation){
  var url = "@@processed?";
  url = url + "remote.adjust.rotate=" + rotation;
  url = url + "&remote.size.w=" + size_w;
  url = url + "&remote.size.h=" + size_h;
  url = url + "&local.crop.h=" + crop_h;
  url = url + "&local.crop.w=" + crop_w;
  url = url + "&local.crop.x=" + crop_x;
  url = url + "&local.crop.y=" + crop_y;
  document.getElementById("${view/escapedName}").value = url;
}

'>
</script>

<script type="text/javascript"
        tal:content="string:
              var url='${context/++resource++imagetool.swf}';
              var img='${view/url}';
              url = url + '?url=' + encodeForFlash(img) + '/@@resized';
              var so = new SWFObject(url, 'image-tool-target', '100%', '490px', '8', 0x000000);
              so.addParam('allowScriptAccess', 'sameDomain');
              so.addParam('movie', url);
              so.addParam('quality', 'high');
              so.addVariable('crop_x', '100');
              so.addVariable('crop_y', '100');
              so.addVariable('crop_w', '100');
              so.addVariable('crop_h', '100');
              so.addVariable('original_w', '600');
              so.addVariable('original_h', '400');
              so.addVariable('zoomfactor', '0.33');
              so.addVariable('rotation', '90');
              so.addVariable('keepAspectRatio', '${view/keepAspect}'); 
              var ok = so.write('image-tool-target');
            ">
</script>