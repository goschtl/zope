<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://namespaces.zope.org/i18n"
      xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>demo picker</title>
    <style type="text/css">
      div {
        padding: 10px;
        margin: 5px;
        border: 1px solid #000;
      }

      div.actions {
        clear: both;
        border-width: 0px;
      }
    </style>
    <script src="jquery"
            type="text/javascript"
            tal:attributes="src context/++resource++jquery.js">
    </script>
    <script type="text/javascript"
            tal:content="string:
             function loadFlash() {
               var url='${context/++resource++imagetool.swf}';
               var img='${context/++resource++img.jpg}';
               url = url + '?url=' + img;
               var so = new SWFObject(url, 'image-tool', '100%', '300px', '8', 0x000000);
               so.addParam('allowScriptAccess', 'sameDomain');
               so.addParam('movie', url);
               so.addParam('quality', 'high');
               so.addVariable('crop_x', '100');
               so.addVariable('crop_y', '100');
               so.addVariable('crop_w', '100');
               so.addVariable('crop_h', '100');
               so.addVariable('original_w', '600');
               so.addVariable('original_h', '400');
               so.addVariable('zoomfactor', '0.33');
               so.addVariable('rotation', '90');
               var ok = so.write('flash-target');
             }
             ">
    </script>
    <script type="text/javascript">
      $(document).ready(loadFlash);

      // user selects an item
      function setIntId(uid) {
        // reset values
        $("textarea").val("");
        $("input[@type=text]").val("");
        // set iniid of selected item
        $("input[@name=intid]").val(uid);
        // highlight selected item
        $("a").attr("style", "");
        $("a[@href*=" + uid + "]").attr("style","background-color: red");
        // show divs
        $("div.properties").show();
        $("div.actions").show();
        $("div.image-tool").show();
      }

      
      $(document).ready(function(){
        // pressed submit button
        // return selected item to parent and close popup
        $("input[@type=submit]").click(function() {
          var intid = $("input[@name=intid]").val();
          window.opener.setIntId(intid);
          window.close();
        });

        // expand window size
        $("a").click(function() {

        });
      });
    </script>
  </head>
  <body>
    <form>
      <div class="picker">
        <b>Target:</b><br />
        <tal:block repeat="item view/items">
          <a href="#"
             tal:attributes="href string:JavaScript:setIntId(${item/uid})">
            <span tal:replace="item/name" />
          </a>
          <br />
        </tal:block>
        <input name="intid" type="text" value="None" />
      </div>
      <div class="properties" style="display:none;">
        <b>Properties:</b><br />
        <label for="title">Title</label>
        <input id="title" name="title" type="text"  /><br />
        <label for="description">Decsprition</label>
        <textarea id="description" name="description"
                  cols="20" rows="10"
                  >abcd</textarea>
      </div>
      <div class="image-tool" style="display:none;">
        <!--div style="display:none;">
          <ul>
            <li><a href="javascript:zoom(1)">zoom in</a></li>
            <li><a href="javascript:zoom(-1)">zoom out</a></li>
            <li><a href="javascript:rotate(1)">rotate right</li>
            <li><a href="javascript:rotate(-1)">rotate left</li>
            <li><a href="javascript:save()">save</a></li>
          </ul>    
        </div-->
        <div id="flash-target">
        </div>
      </div>
      <div class="actions" style="display:none;">
        <input type="submit" value="add reference" />
      </div>
    </form>
  </body>
</html>