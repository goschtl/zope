<tal:block content="structure view/@@pagelet/form" />

<div tal:condition="stats" tal:define="stats view/listStats">
  <h2>Statistics</h2>
  <br />

  <div class="z-table-container">
    <table class="z-table">
      <tbody>
	<tr class="even">
	  <th>Select request:</th>
	  <td><select name="stats" tal:define="default request/stats|nothing">
	      <option tal:repeat="stat stats"
		      tal:attributes="value stat/uri;
				      selected python:stat['uri'] == default"
		      tal:content="string:${stat/uri} (${stat/calls} calls)"></option>
	    </select>
	  </td>
	</tr>
	<tr class="odd">
	  <th>Number of records:</th>
	  <td><input type="text" name="limit:int" 
		     tal:attributes="value request/limit|string:500" />
	  </td>
	</tr>
	<tr class="even">
	  <th>Mode:</th>
	  <td>
	    <select name="mode"
		    tal:define="default request/mode|string:stats">
	      <option tal:repeat="item python:('stats', 'callees', 'callers')"
		      tal:content="item" 
		      tal:attributes="value item; selected python:item == default">
	      </option>
	    </select>
	  </td>
	</tr>
	<tr class="odd">
	  <th>Sort on:</th>
	  <td><select name="sorton"
		      tal:define="default request/sorton|string:time">
	      <option tal:repeat="item python:(
				  ('time', 'internal time'),
				  ('cumulative', 'cumulative time'),
				  ('calls', 'call count'),
				  ('pcalls', 'primitive call count'),
				  ('name', 'function name'),
				  ('file', 'file name'),
				  ('module', 'module name'),
				  ('line', 'line number'),
				  ('nfl', 'name/file/line'),
				  ('stdname', 'standard name'))"
		      tal:attributes="value python:item[0]; 
				      selected python:item[0] == default"
		      tal:content="python:item[1]"></option>
	    </select>
	  </td>
	</tr>
	<tr class="even">
	  <th>Stdname regexp:</th>
	  <td><input name="stdnameRe" 
		     tal:attributes="value request/stdnameRe|nothing" /></td>
	</tr>
	<tr class="odd">
	  <th>Strip dirs:</th>
	  <td><input type="checkbox" name="stripdirs:bool"
		     tal:attributes="checked request/stripdirs|nothing" />
	  </td>
	</tr>
      </tbody>
    </table>
  </div>
  
  <br />
  <input class="z-form-button" type="submit" name="view_stats" value="Update"/>
  
  <br />
  <br />
  <pre tal:content="view/viewStats"></pre>
</div>
