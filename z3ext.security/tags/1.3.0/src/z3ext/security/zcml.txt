====================
z3ext:role directive
====================

PublicRole - это роль которая доступна для UI

   >>> from zope import component

   >>> sm = component.getSiteManager()

Let's create role

   >>> from zope.securitypolicy.role import Role
   >>> from zope.securitypolicy.interfaces import IRole

   >>> role = Role('zope.Member', 'Member')
   >>> sm.registerUtility(role, name='zope.Member')

   >>> manager = Role('zope.Manager', 'Manager')
   >>> sm.registerUtility(manager, name='zope.Manager')

Now load zcml directive and set portal.Member as public role

   >>> from zope.configuration import xmlconfig
   >>> context = xmlconfig.string("""
   ... <configure xmlns:z3ext="http://namespaces.zope.org/z3ext">
   ...    <include package="z3ext.security" file="meta.zcml" />
   ... 
   ...    <z3ext:role role="zope.Member" />
   ...    <z3ext:role role="zope.Manager" manager="true" />
   ... </configure>""")

   >>> from z3ext.security.interfaces import IPublicRole, IManagerRole

   >>> prole = sm.getUtility(IPublicRole, name='zope.Member')
   >>> prole.id == 'zope.Member'
   True
   >>> IPublicRole.providedBy(prole)
   True
   >>> role is prole
   True

   >>> prole = sm.getUtility(IPublicRole, name='zope.Manager')
   >>> IManagerRole.providedBy(prole)
   True
   >>> manager is prole
   True


==========================
z3ext:permission directive
==========================

Let's create permission

   >>> from zope.security.permission import Permission
   >>> from zope.security.interfaces import IPermission

   >>> permission = Permission('portal.Permission', 'Permission')
   >>> sm.registerUtility(permission, name='portal.Permission')

Now load zcml directive and set portal.Member as public pemrission

   >>> context = xmlconfig.string("""
   ... <configure xmlns:z3ext="http://namespaces.zope.org/z3ext">
   ...    <z3ext:permission permission="zope.Public" />
   ... </configure>""", context)
   Traceback (most recent call last):
   ...
   ZopeXMLConfigurationError:...

   >>> context = xmlconfig.string("""
   ... <configure xmlns:z3ext="http://namespaces.zope.org/z3ext">
   ...    <z3ext:permission
   ...         permission="portal.Permission"
   ...         category="z3ext.security.interfaces.IPermissionCategory" />
   ... </configure>""", context)

   >>> from z3ext.security.interfaces import IPublicPermission

   >>> p = sm.getUtility(IPublicPermission, name='portal.Permission')
   >>> p.id == 'portal.Permission'
   True
   >>> IPublicPermission.providedBy(p)
   True
   >>> permission is p
   True
