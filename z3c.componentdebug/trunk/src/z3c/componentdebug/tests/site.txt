;-*-Doctest-*-
=============
Site Managers
=============

z3c.componentdebug examines the registrations of all site managers in
the resolution order::

    >>> from zope.component import getSiteManager
    >>> from zope.component.persistentregistry import (
    ...     PersistentComponents,)
    >>> gsm = getSiteManager()
    >>> sm = PersistentComponents(bases=(gsm,))

    >>> from pprint import pprint
    >>> from z3c.componentdebug.component import getSiteManagers
    >>> pprint([i for i in getSiteManagers(sm)])
    [<PersistentComponents >, <BaseGlobalComponents base>]

    >>> from zope.interface import Interface
    >>> from z3c.componentdebug.component import getRegistrations
    >>> gsm.registerAdapter(lambda x: x, (Interface,), Interface)
    >>> sm.registerAdapter(lambda x: x, (Interface,), Interface)
    >>> pprint([i for i in getRegistrations(context=sm)])
    [AdapterRegistration(<PersistentComponents >, [Interface],
    Interface, u'', <lambda>, u''),
     AdapterRegistration(<BaseGlobalComponents base>, [Interface],
     Interface, u'', <lambda>, u'')]

Check the ComponentLookupError patch for other site managers::

    >>> sm.getAdapter(None, Interface)
    Traceback (most recent call last):
    ...
    ComponentLookupError: (None, <InterfaceClass
    zope.interface.Interface>, u'')

    >>> from zope.interface import implements
    >>> class Foo(object):
    ...     implements(Interface)
    >>> foo = Foo()
    >>> sm.getAdapter(foo, Interface)
    <Foo object at ...>

    >>> from z3c.componentdebug.lookup.patch import patch
    >>> patch()

    >>> sm.getAdapter(None, Interface)
    Traceback (most recent call last):
    ...
    VerboseComponentLookupError: Lookup failed for...
    objects: None
    provided: <InterfaceClass zope.interface.Interface>
    name: 
    context: <PersistentComponents >
    Registrations with matching objects:
    AdapterRegistration(<PersistentComponents >, [Interface],
    Interface, u'', <lambda>, u''):
      - None
    AdapterRegistration(<BaseGlobalComponents base>, [Interface],
    Interface, u'', <lambda>, u''):
      - None
    Objects with matching registrations:
    None:
      - AdapterRegistration(<PersistentComponents >, [Interface],
        Interface, u'', <lambda>, u'')
      - AdapterRegistration(<BaseGlobalComponents base>, [Interface],
        Interface, u'', <lambda>, u'')

    >>> sm.getAdapter(foo, Interface)
    <Foo object at ...>

    >>> from z3c.componentdebug.lookup.patch import cleanup
    >>> cleanup()

    >>> sm.getAdapter(None, Interface)
    Traceback (most recent call last):
    ...
    ComponentLookupError: (None, <InterfaceClass
    zope.interface.Interface>, u'')

    >>> sm.getAdapter(foo, Interface)
    <Foo object at ...>
