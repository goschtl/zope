
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Newbie Search Tutorial</title><meta name="description" content="Grok - now even cavemen can use Zope3" />
  <meta name="keywords" content="Grok, internet, zope, zope3, software, web apps, web applications, python" />
	<style type="text/css"><!-- @import url(/resources/grok.css); --></style>
</head>

<body>
<div class="header">
	
	<a href="http://grok.zope.org">
	<img src="/resources/grok-header.jpg" alt="GROK" /></a>
	<ul id="navigation">
        <li>
            <a href="/index.html" class="" title="Home">Home</a></li>
        <li>
            <a href="/about.html" class="" title="About">About</a></li>
        <li>
            <a href="/tutorial.html" class=""
               title="Tutorial">Tutorial</a></li>
        <li>
            <a href="/minitutorials/index.html" class=""
               title="How Tos">How Tos</a></li>
  </ul>
</div>


<div class="roundcont">
	
  <div class="roundtop">
    <img src="/resources/corner-topleft.jpg" alt="" width="45" height="45" class="corner" style="display: none" />
  </div>

  <div class="content">

          <h1 class="title">Newbie Search Tutorial</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Sebastian Ware</td></tr>
</tbody>
</table>
<div class="section">
<h2><a id="introduction" name="introduction">Introduction</a></h2>
<p>Grok supports the vanilla indexing services available in Zope 3 straight out of
the box. Catalog uses developer defined indexes for searching. In other words,
you have to define the indexes you want to use to search you objects before you
perform the actual search.</p>
<ul class="simple">
<li>FieldIndex: search matching an entire field</li>
<li>SetIndex: search for keywords in a field</li>
<li>TextIndex: full-text searching</li>
<li>ValueSearch: search for values using ranges</li>
</ul>
<p>The time for Zope to generate a new index is proportional to the amount of
objects that need to be analysed.</p>
</div>
<div class="section">
<h2><a id="setup" name="setup">Setup</a></h2>
<p>The egg (package) containing the search functionality is called
[zc.catalog-x.x.x-py2.x.egg] and is installed when &quot;buildout.cfg&quot; contains
&quot;zope.app.catalog&quot; in the list of the directive &quot;zcml=&quot;. This is the default
configuration.</p>
<p>Some applications might require specific versions of catalog. This is specified
in the &quot;setup.py&quot; script. The following directive indicates that zc.catalog
version 1.1.1 is required.</p>
<pre class="code-block python literal-block">
<span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s">'setuptools'</span><span class="p">,</span>
              <span class="s">'grok'</span><span class="p">,</span>
              <span class="s">'zc.catalog==1.1.1'</span><span class="p">,</span>
              <span class="s">'hurry.query'</span><span class="p">,</span>
              <span class="s">'hurry.workflow'</span><span class="p">,</span>
              <span class="p">],</span>

</pre>
<p>The &quot;hurry.query&quot; package gives you some simple tools to perform advanced
searching. (add &quot;hurry.query&quot; to &quot;zcml=&quot; in &quot;buildout.cfg&quot;)</p>
</div>
<div class="section">
<h2><a id="example" name="example">Example</a></h2>
<pre class="code-block python literal-block">
<span class="c"># interfaces.py</span>
<span class="k">class</span> <span class="nc">IProtonObject</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;
    This is an interface to the class who's objects I want to index.
    &quot;&quot;&quot;</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">u'Body'</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

</pre>
<pre class="code-block python literal-block">
<span class="c"># protonobject.py</span>
<span class="k">class</span> <span class="nc">ProtonObject</span><span class="p">(</span><span class="n">grok</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;
    This is the actual class.
    &quot;&quot;&quot;</span>
    <span class="n">interface</span><span class="o">.</span><span class="n">implements</span><span class="p">(</span><span class="n">interfaces</span><span class="o">.</span><span class="n">IProtonObject</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>

</pre>
<pre class="code-block python literal-block">
<span class="c"># app.py</span>
<span class="k">from</span> <span class="nn">hurry.query.query</span> <span class="k">import</span> <span class="n">Query</span><span class="p">,</span> <span class="n">Text</span>
<span class="c"># hurry.query is a simplified search query language that</span>
<span class="c"># allows you to create ANDs and ORs.</span>

<span class="k">class</span> <span class="nc">ContentIndexes</span><span class="p">(</span><span class="n">grok</span><span class="o">.</span><span class="n">Indexes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;
    This is where I setup my indexes. I have two indexes;
    one full-text index called &quot;text_body&quot;,
    one field index called &quot;body&quot;.
    &quot;&quot;&quot;</span>
    <span class="n">grok</span><span class="o">.</span><span class="n">site</span><span class="p">(</span><span class="n">ProtonCMS</span><span class="p">)</span>

    <span class="n">grok</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="n">interfaces</span><span class="o">.</span><span class="n">IProtonObject</span><span class="p">)</span>
    <span class="c"># grok.context() tells Grok that objects implementing</span>
    <span class="c"># the interface IProtonObject should be indexed.</span>

    <span class="n">grok</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s">'proton_catalog'</span><span class="p">)</span>
    <span class="c"># grok.name() tells Grok what to call the catalog.</span>
    <span class="c"># if you have named the catalog anything but &quot;catalog&quot;</span>
    <span class="c"># you need to specify the name of the catalog in your</span>
    <span class="c"># queries.</span>

    <span class="n">text_body</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">'body'</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="s">'body'</span><span class="p">)</span>
    <span class="c"># The attribute='body' parameter is actually unnecessary if the attribute to</span>
    <span class="c"># be indexed has the same name as the index.</span>

<span class="k">class</span> <span class="nc">Index</span><span class="p">(</span><span class="n">grok</span><span class="o">.</span><span class="n">View</span><span class="p">):</span>
    <span class="n">grok</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="n">ProtonCMS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">search_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_query</span><span class="p">):</span>
            <span class="c"># The following query does a search on the field index &quot;body&quot;.</span>
            <span class="c"># It will return a list of object where the entire content of the body attribute</span>
            <span class="c"># matches the search term exactly. I.e. search_query == body</span>
            <span class="n">result_a</span> <span class="o">=</span> <span class="n">Query</span><span class="p">()</span><span class="o">.</span><span class="n">searchResults</span><span class="p">(</span>
                               <span class="n">query</span><span class="o">.</span><span class="n">Eq</span><span class="p">((</span><span class="s">'proton_catalog'</span><span class="p">,</span> <span class="s">'body'</span><span class="p">),</span> <span class="n">search_query</span><span class="p">)</span>
                               <span class="p">)</span>

            <span class="c"># The following query does a search on the full-text index &quot;text_body&quot;.</span>
            <span class="c"># It will return objects that match the search_query. You can use wildcards and</span>
            <span class="c"># boolean operators.</span>
            <span class="c">#</span>
            <span class="c"># Examples:</span>
            <span class="c"># &quot;grok AND zope&quot; returns objects where &quot;body&quot; contains the words &quot;grok&quot; and &quot;zope&quot;</span>
            <span class="c"># &quot;grok or dev*&quot; returns objects where &quot;body&quot; contains the word &quot;grok&quot; or any word</span>
            <span class="c"># beginning with &quot;dev&quot;</span>
            <span class="n">result_b</span> <span class="o">=</span> <span class="n">Query</span><span class="p">()</span><span class="o">.</span><span class="n">searchResults</span><span class="p">(</span>
                               <span class="n">Text</span><span class="p">(</span> <span class="p">(</span><span class="s">'proton_catalog'</span><span class="p">,</span> <span class="s">'text_body'</span><span class="p">),</span> <span class="n">search_query</span><span class="p">)</span>
                               <span class="p">)</span>

            <span class="k">return</span> <span class="n">result_a</span><span class="p">,</span> <span class="n">result_b</span>

</pre>
</div>
<div class="section">
<h2><a id="note" name="note">Note</a></h2>
<p>In the above example, the indexes are only added when a new application is
installed. You will have to manually create new indexes if you wish to add them
to an existing application.</p>
</div>
<div class="section">
<h2><a id="learning-more" name="learning-more">Learning More</a></h2>
<p>The &quot;hurry.query&quot; package contains the DocTest &quot;query.txt&quot; that shows how to
perform more complex search queries.</p>
</div>

  </div>

  <div class="roundbottom">
     <img src="/resources/corner-bottomleft.jpg" alt="" width="45" height="45" class="corner" style="display: none" />
  </div>

</div>

<div class="footer">
	
	<table><tr><td>
	Grok cooks around the campfire of <br />
	<a href="http://wiki.zope.org/zope3/FrontPage"><img src="/resources/zopelogo.gif" alt="Zope" style="padding: 0.5em;" /></a>
	</td><td>
	 and roams free on the savannah of<br />
	<a href="http://www.python.org"><img src="/resources/python-logo.gif" style="padding: 0.5em;" alt="Python" /></a>
	</td></tr>
	</table>

	<p>Hosting provided by <a href="http://quintagroup.com/"><b>Quintagroup</b></a></p>
</div>

</body>
</html>
