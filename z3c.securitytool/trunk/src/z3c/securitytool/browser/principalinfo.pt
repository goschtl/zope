<html>
    <head>
      <link type="text/css" rel="stylesheet" media="all" href=""
           tal:attributes="href context/++resource++securitytool.css"/>
    </head>
    <body>
       <h1>Security Checking Tool</h1>
       <div class="top_nav">
         <span class="top_nav_val"  onclick="javascript:window.location='./securityMatrix.html'"><u>Security Matrix</u>&nbsp|&nbsp</span>
         <span class="top_nav_val">Principal Settings </span>
       </div>
       <p class="description"> The detailed permissions, groups and
         roles for the selected principal are listed below. These are
         all the settings applied to the principal in the system
         with respect to the context or view. The settings Allow or Deny
         are also listed next to each permission.You can go back to
         the matrix page by selecting the `Security Matrix` link above.
       </p>
       <div class="matrix_body">
           <h1 class="just_border">&nbsp</h1>
           <div class="sub_heading">Permission settings for principal <em tal:content="view/principal"></em></div>
           <div class="legend" tal:condition="view/legend" tal:content="structure view/legend"/>
            <metal:block define-macro="user-details"
                         tal:define="permissions view/principalPermissions/permissions;
                                     roles view/principalPermissions/roles;
                                     roleTree view/principalPermissions/roleTree;
                                     permissionTree view/principalPermissions/permissionTree;
                                     groups view/principalPermissions/groups">

                  <div class="context">
                      <h3 tal:condition="permissions"> Directly provided
                      permissions in effect at this context</h3>
                      <div tal:repeat="permissionItem permissions" >
                         <div class="contextListIndent">
                         <div   tal:attributes="class python: permissionItem['setting']"
                                     tal:content="python:
                      permissionItem['permission']"/>
                         </div>
                      </div>
                      <br tal:condition="permissions">



                      <h3 tal:condition="roles">Permissions provided by roles</h3>
                      <div tal:condition="roles">
                        <div tal:repeat="role python: roles">
                          <div class="contextList" tal:content="role">zope.ManageSite:</div>
                          <div  tal:define="permissions python:roles[role]">
                             <div class="contextListIndent"
                                  tal:repeat="permission permissions">
                                  <div  tal:attributes="class permission/setting"
                                        tal:content="permission/permission"/>
                             </div>                      
                          </div>

                          <br>

                        </div>
                      </div>
                  </div>

                  <div class="tree">
                      <h3 tal:condition="permissionTree">Permissions Defined in
                      Context(s) for this user</h3>
                      <tal:block tal:repeat="context permissionTree">
                            <span tal:define="curr python:context.values()[0]">
                                <div class="contextList"
                                     tal:content="python: ' / '.join(curr['parentList'])"/>
                                <div class="contextListIndent" tal:repeat="permission python: curr['permissions']">
                                    <div tal:attributes="class  python:permission['setting']"
                                         tal:content="python: permission['permission']"/>
                                </div>

                            </span>

                      </tal:block>

                      <br tal:condition="permissionTree">

                      <h3 tal:condition="roleTree">Roles Defined in
                      Context(s) for this user</h3>
                      <tal:block tal:repeat="context roleTree">
                            <span tal:define="curr python:context.values()[0]">
                                <div class="contextList"
                      tal:content="python: ' / '.join(curr['parentList'])"/>
                                <div class="contextListIndent" tal:repeat="role python: curr['roles']">
                                    <div tal:attributes="class  python:role['setting']"
                                         tal:content="python: role['role']"/>
                                </div>
                            </span>
                      </tal:block>
                      <br tal:condition="roleTree">
                </div>
                <div class="contentList" tal:condition="groups">
                  <br>
                  <h3>Permissions provided by group(s)</h3>
                    <div class="contentList" tal:repeat="group_id groups">
                      <div tal:content="group_id">zope.Authenticated</div>
                      <div tal:define="group python:groups[group_id];
                                       permissions group/permissions;
                                       roles group/roles;
                                       groups group/groups">
                       <div metal:use-macro="macro:user-details" />
                     </div>
                    </div>
                </div>


           </metal:block>
        </div>
    </body>
</html>
