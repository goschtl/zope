<html>
    <head>
        <link type="text/css" rel="stylesheet" media="all" href=""
              tal:attributes="href context/++resource++securitytool.css"/>
    </head>
<body>
   <h1>Security Checking Tool</h1>
   <h2>View User Matrix</h2>
   <form action="." method="POST"
             tal:attributes="action request/URL">
      <p>Select a skin:
         <select name="selectedSkin">
            <option value="SkinType"
               tal:repeat="skinName view/skinTypes"
               tal:attributes="value skinName; 
               selected python:request.form.has_key('selectedSkin') 
                        and request.form['selectedSkin']==skinName"
               tal:content="skinName">SkinName</option>
         </select>
      </p>
      <p>Filter by permission:   
         <select name="selectedPermission">
            <option value="None">---</option>
            <option value="Permission"
               tal:repeat="permission view/getPermissionList"
               tal:attributes="value permission; 
               selected
         python:request.form.has_key('selectedPermission') 
                and request.form['selectedPermission']==permission"
               tal:content="permission">permission</option>
         </select>
         
      <input type="submit" name="FILTER" value="Filter"/>
      </p>
   </form>
   <br />
   <table tal:define="urlViewName view/urlEncodedViewName" >
       <th class="headings">&nbsp</th>
       <th class="headings"
           tal:repeat="principal view/viewMatrix">
           <a tal:content="principal"
               tal:attributes="href
                        string:principalDetails.html?principal=${principal}">
            Principal</a>
       </th>

       <metal:block tal:repeat="viewObj view/viewList"
                    tal:attributes="class view/cssclass">
          <tr>
            <th align="left" valign="bottom" >
               <h2 tal:content="python: viewObj"/>
            </th>
            <th tal:attributes="colspan python:len(view.viewMatrix)">
              &nbsp
            </th>

          </tr>

          <tr tal:repeat="viewItem python: view.viewList[viewObj]"
               tal:attributes="class view/cssclass">
               <td tal:content="viewItem" style="text-align: left"/>
                <metal:block tal:repeat="principal view/viewMatrix">
                <td tal:define="enc python:urlViewName[viewItem];
                   perm python: view.getPermissionSetting(viewItem,principal)">

                  <a tal:attributes="class perm; 
                    href string:pd.html?principal=${principal}&amp;view=${enc}"
                     tal:omit-tag="python: perm =='--'">
                      <span tal:content="python: perm"
                            tal:omit-tag="">Allow</span>
                  </a>
              </td>
              </metal:block>
           </tr>

       </metal:block>

   </table>
</body>
</html>
