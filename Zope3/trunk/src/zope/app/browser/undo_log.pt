<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html metal:use-macro="views/standard_macros/page">

<head>
<title>Undo Title</title>
<link rel="stylesheet" type="text/css" href="/manage_page_style.css" />
</head>

<body>
<div metal:fill-slot="body">

<form action="@@undo.html" method="post" tal:define="first python:int(request.get('first',0)); all python:request.get('all', None)">

<p class="form-help">
This application's transactional feature allows you to easily undo changes 
made to the application's settings or data. You can revert the application 
to a &quot;snapshot&quot; of it's state at a previous point in time.
</p>

<p class="form-help">
Select one or more transactions below and then click on the &quot;Undo&quot;
button to undo those transactions.  Note that even though a transaction
is shown below, you may not be able to undo it if later transactions
modified objects that were modified by a selected transaction.
</p>

<span tal:condition="all">
<p>You are <span tal:replace="request/user/getId">username</span>, looking at all transactions. <a href="?">View only your own transactions</a>.
<span tal:omit-tag=""
   tal:define="global undoInfo python:view.getUndoInfo(first=first)"/></p>
</span>
<span tal:condition="not:all">
<p>You are <span tal:replace="request/user/getId">username</span>, looking at your own transactions.  <a href="?all=yes">View everyone's transactions</a>.
<!-- This nasty piece of work is needed because user IDs are written to
     the transaction log with a (bogus?) "path" prepended to the username.
     see zodb.ztransaction.Transaction.setUser
     I can't see a way to reconstruct this path right now. I also can't see 
     anywhere that calls setUser() with a path specified. -->
<span tal:omit-tag=""
    tal:define="global undoInfo python:view.getUndoInfo(first=first, user_name='/ '+request.user.getId())"/></p>
</span>

<p><a tal:attributes="href python:'?first=%s'%(first+20)">View 20 earlier transactions</a></p>

<a name="t_list" />

<table width="100%" cellspacing="0" cellpadding="2" border="0" >

  <div tal:repeat="undoitem undoInfo">
  <span tal:condition="repeat/undoitem/odd" ><span tal:define="global rowclass string:content odd"/> </span>
  <span tal:condition="repeat/undoitem/even" ><span tal:define="global rowclass string:content even"/> </span>

  <tr tal:attributes="class rowclass">
    <td width="16" align="left" valign="top">
      <input type="checkbox" name="id_list:list" value="-1" tal:attributes="value undoitem/id"/>
    </td>
    <td tal:attributes="class rowclass" align="left" valign="top">
    <div class="list-item">
     
     <i tal:condition="not:undoitem/description">no description available</i>
     <span tal:condition="undoitem/description" tal:omit-tag=""
           tal:content="undoitem/description">description goes here</span>
     <span tal:condition="undoitem/user_name" tal:omit-tag=""> by 
         <strong tal:content="undoitem/user_name">user_name</strong>
     </span>
    </div>
    </td>

    <td align="right" valign="top" colspan="2" nowrap>
    <div class="list-item" tal:content="python:undoitem['datetime'].strftime('%Y/%m/%d %H:%M:%S')">
      blah date
    </div>
    </td>

  </tr>


<!--

  <tr class="row-hilite">
    <td width="16" align="left" valign="top">
    <input type="checkbox" name="transaction_info:list" 
     value="QTBOekEwdWl6ZmNBQUFBQUV2M0RDdw==
 2002/03/17 00:23:17.7272 US/Eastern /test_area/chumphries/devis_internal_site/people/addDTMLMethod " />
    </td>
    <td align="left" valign="top">
    <div class="list-item">
    /test_area/chumphries/devis_internal_site/people/addDTMLMethod by <strong> chumphries</strong>
    </div>
    </td>
    <td align="right" valign="top" colspan="2" nowrap>
    <div class="list-item">
    2002-03-17 12:23:17 AM
    </div>
    </td>
  </tr>

  </div>

  <tr class="row-normal">
    <td width="16" align="left" valign="top">
    <input type="checkbox" name="transaction_info:list"
     value="QTBOeTQzWURnOVVBQUFBQUV2M0FkUQ==
 2002/03/16 23:51:27.6595 US/Eastern /test_area/chumphries/devis_internal_site/manage_renameObjects " />
    </td>
    <td align="left" valign="top">
    <div class="list-item">
    /test_area/chumphries/devis_internal_site/manage_renameObjects by <strong> chumphries</strong>
    </div>
    </td>
    <td align="right" valign="top" colspan="2" nowrap>
    <div class="list-item">
    2002-03-16 11:51:27 PM
    </div>
    </td>
  </tr>

-->


</div>
<tr><td><input type="submit" value="Undo" /></td></tr>
</table>
</form>

</div>
</body>
</html>

