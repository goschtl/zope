<html metal:use-macro="views/standard_macros/dialog">
<body>
<div metal:fill-slot="body"
   tal:define="hasFilter python:request.get('Filter', None)">

   <p tal:define="status view/update"
      tal:condition="status"
      tal:content="status" />

   <div tal:condition="not: hasFilter">
     <span class="message" i18n:translate="">Apply filter</span>
     <form action="@@PrincipalRoles.html" method="POST">
       <span i18n:translate="">Principal(s)</span>:
       <select name="principals:list" multiple="multiple">
         <option tal:repeat="principal view/getAllPrincipals"
                 tal:attributes="value principal/getId"
                 tal:content="principal/getTitle">my title</option>
       </select>
   
       <span i18n:translate="">Role(s)</span>:
       <select name="roles:list" multiple="multiple">
         <option tal:repeat="role view/getAllRoles"
                 tal:attributes="value role/getId"
                 tal:content="role/getTitle">my title</option>
       </select>
   
       <input type="submit" name="Filter" value="Filter" 
              i18n:attributes="value filter-button"/>
     </form>
   
   </div>

   <div tal:condition="hasFilter">
     <div class="principalRolesGrid"
          tal:define="principalRoleGrid view/createGrid">
   
       <span tal:define="
           global listPrincipals principalRoleGrid/principals;
           global listRoles principalRoleGrid/roles;
           global listValues principalRoleGrid/listAvailableValues" />
   
       <form action="@@PrincipalRoles.html" method="POST">
         <table>
           <tr class="roleHeading">
             <td class="principal">
               &nbsp;
             </td>
             <td class="role" tal:repeat="role listRoles" 
                              tal:content="role/getTitle">
               Role Id
             </td>
           </tr>
   
           <tr class="principalRoleRow" tal:repeat="principal listPrincipals">
             <td class="principalLabel" tal:content="principal/getTitle">
               Principal Id
             </td>
   
             <td class="principalRole" tal:repeat="role listRoles">
               <select name="grid.role.principal:records"
                       tal:attributes="
                           name string:grid.${role/getId}.${principal/getId}"
                       tal:define="selectedValue 
                                   python:principalRoleGrid.getValue(
                                              principal.getId(), 
                                              role.getId()
                                              )" >
                 <option value="" tal:repeat="defaultValue listValues"
                         tal:attributes="
                             selected python:defaultValue==selectedValue;
                             value defaultValue;
                             debugsel selectedValue"
                        tal:content="defaultValue">
                   &nbsp;
                 </option>
               </select>
             </td>
           </tr>
   
         </table>

         <input type="hidden" name="principals:list"
                tal:repeat="principal listPrincipals"
                tal:attributes="value principal/getId" />

         <input type="hidden" name="roles:list"
                tal:repeat="role listRoles"
                tal:attributes="value role/getId" />
   
         <input type="submit" name="APPLY" value="Apply" 
                i18n:attributes="value apply-button"/>
   
       </form>
   
     </div>
   </div>

</div>
</body>
</html>
