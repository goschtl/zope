Groups & Principals
===================

We import the needed modules

  >>> from zope.app.groupfolder.group import Group
  >>> from zope.security.interfaces import IGroupAwarePrincipal
  >>> from zope.app.groupfolder.groupfolder import GroupFolder
  >>> from zope.app.groupfolder.interfaces import IGroupFolder
  >>> from zope.app.pas.principalplugins import PrincipalFactory
  >>> from zope.publisher.tests.httprequest import TestRequest
  >>> import zope.app.zapi

We first create a group folder and add some groups:

  >>> name, groups = list(zope.app.zapi.getUtilitiesFor(IGroupFolder))[0]
  >>> geeks = Group(id='geeks', principalsids=['srichter','jim'])
  >>> newbies = Group(id='newbies', principalsids=['amos','claudia'])
  >>> sprinters = Group(id='sprinters', 
  ...                   principalsids=['srichter', 'jim', 'amos','claudia'])
  >>> for g in [geeks, sprinters, newbies]: groups[g.id] = g

Now we create some principals and check if they operate correctly:

1) Instantiate a Principal Factory

  >>> pf  = PrincipalFactory()
    
2) Get some principals

  >>> srichter = pf.createAuthenticatedPrincipal('srichter', {} , 
  ...                                            TestRequest())
  >>> IGroupAwarePrincipal.providedBy(srichter)
  True
  >>> groups.getGroupsForPrincipal(srichter.id)
  ['geeks', 'sprinters']
  >>> thomas = pf.createAuthenticatedPrincipal('thomas', {} , TestRequest())
  >>> groups.getGroupsForPrincipal(thomas.id)
  []
  >>> amos = pf.createAuthenticatedPrincipal('amos', {} , TestRequest())
  >>> groups.getGroupsForPrincipal(amos.id)
  ['sprinters', 'newbies']
    
3) Now we add a group and check that getGroupsForPrincipal gets updated but 
   principal group info gets NOT updated:

  >>> thinkers = Group(id='thinkers', 
  ...                  principalsids=['srichter', 'jim', 'thomas','robert'])
  >>> groups[thinkers.id] = thinkers
  >>> groups.getGroupsForPrincipal(srichter.id)
  ['geeks', 'sprinters', 'thinkers']
  >>> srichter.groups
  ['geeks', 'sprinters']
    
