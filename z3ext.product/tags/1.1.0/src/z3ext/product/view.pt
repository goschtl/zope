<div i18n:domain="z3ext.product" tal:define="data view/getProducts">
  <div class="topframe" tal:condition="data/installed">
    <h1>Installed Products</h1>

    <form tal:attributes="action request/URL" method="post">
      <ul class="listing">
	<li tal:repeat="product data/installed">
	  <div class="icon">
	    <input class="noborder" type="checkbox" name="products:list" 
		   tal:attributes="value product/name"
		   tal:condition="product/uninstallable" />
	    <tal:block tal:condition="not:product/uninstallable">
	      &nbsp;&nbsp;&nbsp;&nbsp;</tal:block>
	    <img tal:replace="structure product/product/@@zmi_icon" />
	  </div>
	  <div class="details">
	    <a tal:omit-tag="not:product/configlet"
	       tal:attributes="href string:${product/name}/">
	      <span tal:content="product/title"></span>
	    </a>
	    <div tal:content="product/description"></div>
	  </div>
	  <div class="small"
	       tal:define="name product/name;
			   extensions python:view.getExtensions(product['product'])"
	       tal:condition="extensions">
	    <ul class="listing">
	      <li tal:repeat="product extensions">
		<div class="icon">
		  <img tal:replace="structure product/@@zmi_icon" />
		</div>
		<div class="details">
		  <span>
		    <a tal:omit-tag="not:product/isAvailable"
		       tal:attributes="href string:${product/__parent__/__name__}/${product/__name__}/">
		      <span tal:content="product/__title__"></span>
		    </a>
		    <a tal:attributes="href 
		         string:${context/@@absolute_url}/?extension=${product/__id__}"
		       tal:condition="product/__installed__">
		      (Installed)
		    </a>
		    <a tal:attributes="href
		         string:${context/@@absolute_url}/?extension=${product/__id__}"
		       tal:condition="not:product/__installed__">
		      (Not installed)
		    </a>
		  </span>
		  <div tal:content="product/__description__"></div>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
      </ul>

      <div class="formControls" tal:condition="data/hasUninstallable">
	<input type="submit" class="z-form-button" name="update" value="Update" />
	<input type="submit" class="z-form-removebutton" name="uninstall" value="Uninstall" />
      </div>
    </form>
  </div>
  
  <div class="frame" tal:condition="data/notinstalled"
       tal:attributes="class python:not data['installed'] and 'topframe' or 'frame'">
    <h1>Products available for install</h1>
    <p>This is the Add-on Products install section, you can add products in the lists below.</p>

    <form tal:attributes="action request/URL" method="post">
      <ul class="listing">
	<li tal:repeat="product data/notinstalled">
	  <div class="icon">
	    <input class="noborder" type="checkbox"
                   name="products:list" tal:attributes="value product/name" />
	    <img tal:replace="structure product/product/@@zmi_icon" />
	  </div>
	  <div class="details">
	    <span tal:content="product/title"></span>
	    <div tal:content="product/description"></div>
	  </div>
	</li>
      </ul>

      <div class="formControls">
	<input type="submit" class="context" name="install" value="Install" />
      </div>
    </form>
  </div>
</div>
