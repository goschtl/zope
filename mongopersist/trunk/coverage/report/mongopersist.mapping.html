
    <html>
      <head><title>Test coverage for mongopersist.mapping</title>
      <style type="text/css">
        a {text-decoration: none; display: block; padding-right: 1em;}
        a:hover {background: #EFA;}
        hr {height: 1px; border: none; border-top: 1px solid gray;}
        .notcovered {background: #FCC;}
        .footer {margin: 2em; font-size: small; color: gray;}
      </style>
      </head>
      <body><h1>Test coverage for mongopersist.mapping</h1>
      <table>
    
<tr><td><a href="mongopersist.html">mongopersist/</a></td> <td style="background: yellow">&nbsp;&nbsp;&nbsp;&nbsp;</td> <td>covered 99% (1 of 695 uncovered)</td></tr>
<tr><td><a href="mongopersist.mapping.html">&nbsp;&nbsp;&nbsp;&nbsp;mapping.py</a></td> <td style="background: green">&nbsp;&nbsp;&nbsp;&nbsp;</td> <td>covered 100% (0 of 36 uncovered)</td></tr>
</table><hr/>
<pre>
       <I><FONT COLOR="#B22222">##############################################################################
</FONT></I>       <I><FONT COLOR="#B22222">#
</FONT></I>       <I><FONT COLOR="#B22222"># Copyright (c) 2011 Zope Foundation and Contributors.
</FONT></I>       <I><FONT COLOR="#B22222"># All Rights Reserved.
</FONT></I>       <I><FONT COLOR="#B22222">#
</FONT></I>       <I><FONT COLOR="#B22222"># This software is subject to the provisions of the Zope Public License,
</FONT></I>       <I><FONT COLOR="#B22222"># Version 2.1 (ZPL).  A copy of the ZPL should accompany this distribution.
</FONT></I>       <I><FONT COLOR="#B22222"># THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY AND ALL EXPRESS OR IMPLIED
</FONT></I>       <I><FONT COLOR="#B22222"># WARRANTIES ARE DISCLAIMED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
</FONT></I>       <I><FONT COLOR="#B22222"># WARRANTIES OF TITLE, MERCHANTABILITY, AGAINST INFRINGEMENT, AND FITNESS
</FONT></I>       <I><FONT COLOR="#B22222"># FOR A PARTICULAR PURPOSE.
</FONT></I>       <I><FONT COLOR="#B22222">#
</FONT></I>       <I><FONT COLOR="#B22222">##############################################################################
</FONT></I>    1: <B><FONT COLOR="#BC8F8F">&quot;&quot;&quot;Mongo Mapping Implementations&quot;&quot;&quot;</FONT></B>
    1: <B><FONT COLOR="#A020F0">import</FONT></B> UserDict
    1: <B><FONT COLOR="#A020F0">import</FONT></B> pymongo
       
    1: <B><FONT COLOR="#A020F0">from</FONT></B> mongopersist <B><FONT COLOR="#A020F0">import</FONT></B> interfaces
       
    2: <B><FONT COLOR="#A020F0">class</FONT></B> MongoCollectionMapping(UserDict.DictMixin, object):
    1:     __mongo_database__ = None
    1:     __mongo_collection__ = None
    1:     __mongo_mapping_key__ = <B><FONT COLOR="#BC8F8F">'key'</FONT></B>
       
    1:     <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">__init__</FONT></B>(self, jar):
    8:         self._m_jar = jar
       
    1:     <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">__mongo_filter__</FONT></B>(self):
    9:         <B><FONT COLOR="#A020F0">return</FONT></B> {}
       
    1:     <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">get_mongo_collection</FONT></B>(self):
   14:         db_name = self.__mongo_database__ <B><FONT COLOR="#A020F0">or</FONT></B> self._m_jar.default_database
   14:         <B><FONT COLOR="#A020F0">return</FONT></B> self._m_jar._conn[db_name][self.__mongo_collection__]
       
    1:     <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">__getitem__</FONT></B>(self, key):
    6:         filter = self.__mongo_filter__()
    6:         filter[self.__mongo_mapping_key__] = key
    6:         doc = self.get_mongo_collection().find_one(filter)
    6:         <B><FONT COLOR="#A020F0">if</FONT></B> doc <B><FONT COLOR="#A020F0">is</FONT></B> None:
    2:             <B><FONT COLOR="#A020F0">raise</FONT></B> KeyError(key)
    4:         db_name = self.__mongo_database__ <B><FONT COLOR="#A020F0">or</FONT></B> self._m_jar.default_database
    4:         dbref = pymongo.dbref.DBRef(
    4:             self.__mongo_collection__, doc[<B><FONT COLOR="#BC8F8F">'_id'</FONT></B>], db_name)
    4:         <B><FONT COLOR="#A020F0">return</FONT></B> self._m_jar._reader.get_ghost(dbref)
       
    1:     <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">__setitem__</FONT></B>(self, key, value):
               <I><FONT COLOR="#B22222"># Even though setting the attribute should register the object with
</FONT></I>               <I><FONT COLOR="#B22222"># the data manager, the value might not be in the DB at all at this
</FONT></I>               <I><FONT COLOR="#B22222"># point, so registering it manually ensures that new objects get added.
</FONT></I>    2:         self._m_jar.register(value)
    2:         setattr(value, self.__mongo_mapping_key__, key)
       
    1:     <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">__delitem__</FONT></B>(self, key):
               <I><FONT COLOR="#B22222"># Deleting the object from the database is not our job. We simply
</FONT></I>               <I><FONT COLOR="#B22222"># remove it from the dictionary.
</FONT></I>    1:         value = self[key]
    1:         setattr(value, self.__mongo_mapping_key__, None)
       
    1:     <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">keys</FONT></B>(self):
    7:         filter = self.__mongo_filter__()
    7:         filter[self.__mongo_mapping_key__] = {<B><FONT COLOR="#BC8F8F">'$ne'</FONT></B>: None}
               <B><FONT COLOR="#A020F0">return</FONT></B> [
    7:             doc[self.__mongo_mapping_key__]
   15:             <B><FONT COLOR="#A020F0">for</FONT></B> doc <B><FONT COLOR="#A020F0">in</FONT></B> self.get_mongo_collection().find(filter)]
</pre>

      <div class="footer">
      Generated for revision 5108:5114M on 2011-11-04 17:02:17.574731Z
      </div>
    </body>
    </html>
