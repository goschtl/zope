========
The Page
========

First we create a site:

  >>> from zope.app.testing import setup
  >>> from zope.app.folder import rootFolder
  >>> site = rootFolder()
  >>> setup.createSiteManager(site, setsite=True)
  <zope.app.component.site.LocalSiteManager object at ...>

  >>> site['image.gif'] = object()
  >>> site['file.txt'] = object()
  
  >>> import zope.interface
  >>> class IFaux(zope.interface.Interface):
  ...     pass
  
  >>> class Faux(object):
  ...     zope.interface.implements(IFaux)

  >>> from zope.webdev.page import Page,registerPage,reregisterPage
  >>> from zope.webdev.interfaces import IPage
  >>> from zope.app.container.interfaces import IReadContainer
  >>> names_html = Page('names.html', for_=IFaux)
  
  >>> names_html.templateSource = u'''
  ... <html>
  ...   <body>
  ...     <h1>Folder contents</h1>
  ...     <ul>
  ...       <li tal:repeat="name view/names"
  ...           tal:content="name" />
  ...     </ul>
  ...   </body>
  ... </html>
  ... '''

  >>> names_html.moduleSource = '''
  ... class FolderContents(object):
  ...     @property
  ...     def names(self):
  ...         return sorted(self.context.keys())
  ... '''
  >>> names_html.className = 'FolderContents'
    
  >>> site.getSiteManager()['default']['names.html'] = names_html
  >>> registerPage(names_html)

First we do a lookup on contextg we know should not have this view since we
accidentially registered it for IFaux instead of IReadContainer.

  >>> import zope.component
  >>> from zope.publisher.browser import TestRequest
  >>> request = TestRequest()
  >>> zope.component.getMultiAdapter(
  ...     (site, request), name='names.html')
  Traceback (most recent call last):
  ...
  ComponentLookupError: ...
  
We create an instance of Faux and work with that one and do a view lookup
on it.  It should succeed.

  >>> zope.component.getMultiAdapter(
  ...     (Faux(), request), name='names.html')  
  <zope.app.presentation.registration.BoundTemplate ...>
  
Now we correct the registration by making it a view for IReadContainer.

  >>> names_html.for_ = IReadContainer
  >>> reregisterPage(names_html)
  >>> zope.component.getMultiAdapter(
  ...     (site, request), name='names.html')
  <zope.app.presentation.registration.BoundTemplate ...>

Since we have registered the component with a different for_ interface, trying
to look it up on Faux should now fail again.

  >>> zope.component.getMultiAdapter(
  ...     (Faux(), request), name='names.html')  
  Traceback (most recent call last):
  ...
  ComponentLookupError: ...
  

Now the page is setup and it should be available for any folder:

  >>> import zope.component
  >>> from zope.publisher.browser import TestRequest
  >>> request = TestRequest()

  >>> page = zope.component.getMultiAdapter(
  ...     (site, request), name='names.html')
  

Now render the page:

  >>> print page()
  <html>
    <body>
      <h1>Folder contents</h1>
      <ul>
        <li>file.txt</li>
        <li>image.gif</li>
      </ul>
    </body>
  </html>

  >>> del(page)
  >>> names_html.moduleSource = '''
  ... class FolderContents(object):
  ...     @property
  ...     def names(self):
  ...         return sorted(self.context.keys(),reverse=True)
  ... '''
  >>> request = TestRequest()
  >>> page = zope.component.getMultiAdapter(
  ...     (site, request), name='names.html')


  >>> print page()
  <html>
    <body>
      <h1>Folder contents</h1>
      <ul>
        <li>image.gif</li>
        <li>file.txt</li>
      </ul>
    </body>
  </html>

  >>> names_html.templateSource=u"""abc"""
  >>> print page()
  abc
