<?xml version="1.0"?>
<workflow-tool xmlns:tal="http://xml.zope.org/namespaces/tal">
 <workflows>

  <workflow
        workflow_id="dcworkflow"
        type="DCWorkflow"
        title="Some DCWorkflwo"
        tal:repeat="workflow here/listWorkflowInfo"
        tal:attributes="workflow_id workflow/id;
                        title workflow/title;
                       ">

   <permissions>
    <permission
        name="View"
        tal:repeat="permission workflow/permissions"
        tal:attributes="name permission"
        />
   </permissions>

   <variables
        state_variable="review_state" 
        tal:attributes="state_variable workflow/state_variable">
    <variable
        variable_id="action"
        for_catalog="0"
        for_status="1"
        update_always="1" 
        default_expression="transition/getId | nothing"
        guard_roles="Request review; Review portal content" 
        tal:repeat="info workflow/variable_info"
        tal:attributes="variable_id info/id;
                        for_catalog info/for_catalog;
                        for_status info/for_status;
                        update_always info/update_always;
                        default_value info.default_value;
                        default_expression info/default_expr;
                        guard_permissions info/guard_permissions;
                        guard_roles info/guard_roles;
                        guard_expr info/guard_expr;
                       ">
     <span tal:replace="info/description">The last transition</span>
    </variable>
   </variables>

   <worklists>
    <worklist
        worklist_id="reviewer_queue"
        action_name="Pending (%(count)d)"
        action_url="%(portal_url)s/search?review_state=pending"
        action_category="global" 
        guard_permissions="Review portal content"
        tal:repeat="info workflow/worklist_info"
        tal:attributes="worklist_id info/id;
                        action_name info/actbox_name;
                        action_url info/actbox_url;
                        action_category info/actbox_category;
                        guard_permissions info/guard_permissions;
                        guard_roles info/guard_roles;
                        guard_expr info/guard_expr;
                       ">
      <span tal:replace="info/description">Reviewer tasks</span>
     <match
        name="review_state"
        values="pending" 
        tal:repeat="match info/var_match"
        tal:attributes="name python: match[ 0 ];
                        values python: match[ 1 ];
                       "
        />
    </worklist>
   </worklists>
        
   <states
        initial="visible" 
        tal:attributes="initial workflow/initial_state">
    <state
        state_id="pending"
        title="Waiting for reviewer"
        transitions="hide,publish,defer,retract"
        tal:repeat="info workflow/state_info"
        tal:attributes="state_id info/id;
                        title info/title;
                        transitions python: ','.join( info[ 'transitions' ] );
                       ">
     <permissions>
      <permission
        name=""
        acquired="1"
        roles=""
        tal:repeat="perm info/permissions"
        tal:attributes="name perm/name;
                        roles python: ','.join( perm[ 'roles' ] );
                        acquired perm/acquired;
                       "
        />
     </permissions>
     <assignments>
      <assignment
        name=""
        value=""
        tal:repeat="var info/variables"
        tal:attributes="name python:var[0];
                        value python:var[1];
                       "
        />
     </assignments>
    </state>
   </states>

   <transitions>
    <transition
        transition_id="Publish"
        title="Reviewer publishes content"
        new_state="published"
        trigger="USER"
        before_script=""
        after_script=""
        action_name="Publish"
        action_url="%(content_url)s/content_publish_form"
        action_category="workflow"
        guard_permissions="Review portal content"
        guard_roles=""
        guard_expr="python: True"
        tal:repeat="info workflow/transition_info"
        tal:attributes="transition_id info/id;
                        title info/title;
                        new_state info/new_state_id;
                        trigger info/trigger_type;
                        before_script info/before_script_name;
                        after_script info/after_script_name;
                        action_name info/actbox_name;
                        action_url info/actbox_url;
                        action_category info/actbox_category;
                        guard_permissions info/guard_permissions;
                        guard_roles info/guard_roles;
                        guard_expr info/guard_expr;
                       ">
     <assignments>
      <assignment
        name=""
        expression="" 
        tal:repeat="var info/variables"
        tal:attributes="name python:var[0];
                        expression python:var[1];
                       "
        />
     </assignments>
    </transition>
   </transitions>

  </workflow>
 </workflows>

 <chains
        default="default_workflow"
        tal:attributes="default python:','.join(here.getDefaultChain())">
    <type
        type_id="Folder"
        chain=""
        tal:repeat="info here/listTypeChains"
        tal:attributes="name info/id;
                        chain python: ','.join( info[ 'chain' ] );
                       "/>
 </chains>

</workflow-tool>
