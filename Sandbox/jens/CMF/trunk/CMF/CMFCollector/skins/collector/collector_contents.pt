<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master">

<span tal:replace="nothing">
  Template description: Batching view of the collector issues.
</span>

<body>

<div metal:fill-slot="header">

  <div metal:use-macro="here/collector_macros/macros/collector_header">
    COLLECTOR HEADER
  </div>

</div>

<div metal:fill-slot="main">

<div tal:condition="not: collector_header_present|nothing">
  <span tal:condition="nothing"> If master has no macro "header"... </span>
  <div metal:use-macro="here/collector_macros/macros/collector_header">
    COLLECTOR HEADER
  </div>

</div>

<!-- This is the desktop area -->
<div class="Desktop"
     tal:define="Batch python:modules['ZTUtils'].Batch;
                 pysutil modules/Products.PythonScripts.standard;
                 strmod modules/string;
                 cap nocall: strmod/capitalize;
                 DateTime nocall: modules/DateTime/DateTime;
                 BATCHSIZE python: 10;
                 TITLELEN python: 35;
                 DESCRLEN python: 120;
                 b_start python: request.get('b_start', 0);
                 items here/collector_search;
                 batch python: Batch(items, BATCHSIZE, int(b_start), orphan=0);
                 prev batch/previous;
                 next batch/next|nothing;
                 last_batch python: max(int(here.length()) - BATCHSIZE, 1)">

    <div metal:use-macro="here/collector_macros/macros/issue_batch_nav">
      ISSUE-BATCH NAVIGATION
    </div>

    <table class="FormLayout">
      <tbody tal:repeat="item batch">

        <tr tal:define="itemattrs python: here.collector_issue_subject_attrs(item);
                        itemurl item/getURL;
                        itemtype item/Type|nothing;
                        icon item/getIcon|item/icon|nothing">

          <td>
             <a href=""
                tal:attributes="href item/getURL">
                <img src="" alt="" border="0"
                     tal:condition="icon"
                     tal:attributes="src icon;
                                     alt itemtype">
                <span tal:replace="itemtype"
                      tal:condition="not: icon"></span>
            </a>
          </td>

          <td>
            <a href="ITEMURL" tal:attributes="href item/getURL">
              <span tal:replace="item/id">ID</span> </a>
          </td>
          <td NOWRAP>
            <a href="ITEMURL" tal:attributes="href item/getURL">
              <b><span tal:condition="item/Title"
                       tal:replace="python:
                                     item.Title[:TITLELEN]
                                    + (item.Title[TITLELEN:] and '...')">
              TITLE</span></b></a>
            <br>
              <span tal:condition="python: int(itemattrs['security_related'])">
                <font color="red">Security</font></span>
              <em><span tal:content="python: cap(item.review_state)">
                STATUS</span></em>
              <span tal:replace="python: '%s/%s'
                                       % (cap(itemattrs['topic']),
                                          cap(itemattrs['classification']))">
                TOPIC/CLASSIFICATION
              </span>
          </td>

          <td NOWRAP
              tal:define="numcmts python: int(itemattrs['action_number'])-1;
                          plrlcmts python: (numcmts != 1) and 's' or '';
                          numuploads python: int(itemattrs['upload_number']);
                          plrluploads python: (numuploads != 1) and 's' or ''">
            <span tal:condition="numcmts">
              <span tal:replace="numcmts">NUM COMMENTS</span>
              followup<span tal:replace="plrlcmts">S?</span>
            </span>
            <span tal:condition="not: numcmts"
                  tal:replace="nothing"></span>

              <div tal:condition="numuploads">
                <span tal:replace="numuploads">NUM ARTIFACTS</span>
                upload<span tal:replace="plrluploads">S?</span>
              </div>
          </td>

          <td NOWRAP
              tal:define="crdate python: item.created.aCommon();
                          moddate python: item.modified.aCommon()">
            <span tal:replace="crdate">CREATEDATE</span>
            <div tal:condition="python: crdate != moddate">
              Last Mod: <span tal:replace="moddate">MODDATE</span>
            </div>
          </td>
        </tr>

        <tr tal:condition="item/Description">
          <td>
          </td>
          <td colspan="7">
            <font color="gray"
                  tal:content="python: item.Description[:DESCRLEN]
                               + (item.Description[DESCRLEN:] and '...')">
              DESCRIPTION</font>
          </td>
        </tr>

      </tbody>
    </table>

    <div metal:use-macro="here/collector_macros/macros/issue_batch_nav">
      ISSUE-BATCH NAVIGATION
    </div>

  <form action="collector_search" method="get">
  Fulltext Search:  <input type="text" name="SearchableText" size="40">
  <div>
    Requestor:  <select name="Creator:list" multiple size="5">
                  <option value=""
                          tal:define="items python: here.portal_catalog.uniqueValuesFor('Creator')"
                          tal:repeat="item items"
                          tal:attributes="value item"
                          tal:content="item">
                  </option>
                </select>
  </div>
  <div>
    Status:  <select name="status:list" multiple size="5">
               <option value=""
                       tal:define="items python: here.portal_catalog.uniqueValuesFor('review_state')"
                       tal:repeat="item items"
                       tal:attributes="value item"
                       tal:content="item">
               </option>
             </select>
  </div>
  <div>
    Security Related:  <input type="checkbox" name="security_related" value="1">
  </div>
  <div>
    Classification:  <select name="classifications:list" multiple size="5">
                       <option value=""
                               tal:define="items here/classifications"
                               tal:repeat="item items"
                               tal:attributes="value item"
                               tal:content="item">
                       </option>
                     </select>
  </div>
  <div>
    Severity: <select name="severities:list" multiple size="5">
                <option value=""
                        tal:define="items here/severities"
                        tal:repeat="item items"
                        tal:attributes="value item"
                        tal:content="item">
                </option>
              </select>
  </div>
  <div>
    <input type="Submit" value="Search">
  </div>
</form>

</div>
</div>
</body>
</html>

