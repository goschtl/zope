============
tfws.website
============

  >>> from tfws.website import testing
  >>> from z3c.etestbrowser.testing import ExtendedTestBrowser
  >>> browser = ExtendedTestBrowser()
  >>> browser.addHeader('Authorization', 'Basic mgr:mgrpw')
  >>> browser.handleErrors = False
  >>> browser.open("http://localhost/")

Unauthorized users cannot access the server root.

  >>> user = ExtendedTestBrowser()
  >>> user.open("http://localhost/")
  Traceback (most recent call last):
  ...
  HTTPError: HTTP Error 401: Unauthorized

Adding a site
-------------

Using our authenticated browser instance we can add a website.

  >>> browser.open("http://localhost/++skin++tfwswebsite/add")
  >>> browser.getControl('name').value = u'treefern'
  >>> browser.getControl('Title').value = u'Tree Fern'
  >>> browser.getControl('Login').value = u'darrylcousins'
  >>> browser.getControl('Password').value = u'tfws'
  >>> browser.getControl('First Name').value = u'Darryl'
  >>> browser.getControl('Last Name').value = u'Cousins'
  >>> browser.getControl('Email').value = u'darry.cousins@tfws.org.nz'
  >>> browser.getControl('Add').click()

The new site is now included in the table of sites available.

  >>> browser.open("http://localhost/")
  >>> testing.printElement(browser, "//table/tbody/tr[1]/td/a/text()",
  ...                      multiple=True, serialize=False )
  treefern
  Tree Fern

Deleting a site
---------------

Sites can be deleted, first we add another

  >>> browser.open("http://localhost/++skin++tfwswebsite/add")
  >>> browser.getControl('name').value = u'treefern2'
  >>> browser.getControl('Title').value = u'Tree Fern'
  >>> browser.getControl('Login').value = u'darrylcousins'
  >>> browser.getControl('Password').value = u'tfws'
  >>> browser.getControl('First Name').value = u'Darryl'
  >>> browser.getControl('Last Name').value = u'Cousins'
  >>> browser.getControl('Email').value = u'darry.cousins@tfws.org.nz'
  >>> browser.getControl('Add').click()
  >>> 'treefern2' in browser.contents
  True

Yep, it's there.

  >>> browser.getControl(name='selected:list').value = ['treefern2']
  >>> browser.getControl(name='confirm_delete').value = u'yes'
  >>> browser.getControl('Delete').click()
  >>> 'treefern2' in browser.contents
  False

Yes, it's gone.

Accessing the site
------------------

We can access the new site.

  >>> browser.getLink('treefern').click()
  >>> testing.printElement(browser, "//h1")
  <h1>Tree Fern</h1>

Unauthorized users can access the site.

  >>> user.open("http://localhost/treefern/index")
  >>> print user.url
  http://localhost/treefern/index

Login
-----

We have a login form.

  >>> user.handleErrors = False
  >>> user.open("http://localhost/treefern/login")
  >>> user.getControl('Username').value = u'darrylcousins'
  >>> user.getControl('Password').value = u'tfws'
  >>> user.getControl('Login').click()
  >>> print user.url
  http://localhost/treefern

We can log out also.

  >>> user.open("http://localhost/treefern/logout")
  >>> print user.url
  http://localhost/treefern/

Accessing an edit view will cause redirection to login form.

  >>> user.handleErrors = True
  >>> user.open("http://localhost/treefern/edit")
  >>> print user.url
  http://localhost/treefern/@@login?camefrom=%2Ftreefern%2Fedit
  >>> user.getControl('Username').value = u'darrylcousins'
  >>> user.getControl('Password').value = u'tfws'
  >>> user.getControl('Login').click()
  >>> print user.url
  http://localhost/treefern/edit

Members
-------

Views are provided for members folder and members.

  >>> user.handleErrors = False
  >>> user.open('http://localhost/treefern/members')
  >>> user.getLink('Darryl Cousins').click()

We now have the edit form for a member.

  >>> user.getControl('First Name').value = u'Darryl Jon'
  >>> user.getControl('Change Password').value = u'secret'
  >>> user.getControl('Verify Password').value = u'osecret'
  >>> user.getControl('Apply').click()

Invariant validation on password fields.

  >>> 'Passwords do not match' in user.contents
  True

  >>> user.getControl('First Name').value = u'Darryl Jon'
  >>> user.getControl('Change Password').value = u'secret'
  >>> user.getControl('Verify Password').value = u'secret'
  >>> user.getControl('Apply').click()
  >>> 'Data successfully updated' in user.contents
  True



