[buildout]
parts = master
        ${projects:result-sections}
        poller
        slaves
        reboot-slaves
versions = versions
extensions = buildout.dumppickedversions
allow-picked-versions = false

[versions]
buildbot = 0.7.12
buildout.dumppickedversions = 0.4
collective.buildbot = 0.4.1
distribute = 0.6.10
manuel = 1.0.5
Paste = 1.7.3
PasteDeploy = 1.3.3
PasteScript = 1.7.3
setuptools = 0.6c11
Twisted = 10.0.0
virtualenv = 1.4.6
z3c.recipe.usercrontab = 1.0
zc.buildout = 1.4.3
zc.recipe.egg = 1.2.2
zc.recipe.macro = 1.3.0
zc.recipe.testrunner = 1.2.0
zope.exceptions = 3.5.2
zope.interface = 3.5.3
zope.testing = 3.9.4

[master]
recipe = collective.buildbot:master
project-name = Zope Buildbot
max-builds = 1
allow-force = true
slaves =
    slave-ubuntu32 secret
    slave-ubuntu64 secret
    slave-osx secret
    slave-win-py2.5 secret
    slave-win-py2.6 secret

[slaves]
recipe = zc.recipe.macro
result-recipe = collective.buildbot:slave
macro = slave-macro
targets = slave-ubuntu32
          slave-ubuntu64
          slave-osx
          slave-win-py2.5
          slave-win-py2.6
          
[slave-macro]
host = localhost
port = 8999
password = secret


[poller]
recipe = collective.buildbot:poller
repositories = http://svn.zope.org/repos/main
poll-interval = 3600


[project-macro]
slave-names = $${:slaves}
vcs = svn
vcs-mode = clobber
repositories = $${:repos}
mail-host = localhost
email-notification-sender = no-reply@localhost
email-notification-recipients = ${{:mailto}
build-sequence = 
    $${:bootstrap}
    $${:buildout}
test-sequence = $${:test}
periodic-scheduler = 1440
# sensible defaults
test = bin/test
buildout = bin/buildout -v
mailto = root@localhost
# Working around the virtualenv of collective.buildbot in order to have one 
# buildslave per platform. We 'just know' the location of the python 
# interpreter.
bootstrap = /usr/bin/python2.6 /tmp/bootstrap.py 
slaves = slave-ubuntu32
         slave-ubuntu64
         slave-osx

[project-py2.5-defaults]
bootstrap = /usr/bin/python2.5 /tmp/bootstrap.py 

[project-win-py2.5-defaults]
slaves = slave-win-py2.5
bootstrap = C:\projects\virtualenv-2.5\Scripts\python C:\projects\bootstrap.py
buildout = bin\buildout
test = bin\test

[project-win-py2.6-defaults]
slaves = slave-win-py2.6
bootstrap = C:\projects\virtualenv-2.6\Scripts\python C:\projects\bootstrap.py
buildout = bin\buildout
test = bin\test

[projects]
recipe = zc.recipe.macro
result-recipe = collective.buildbot:project
macro = project-macro
targets = bin-test_py2.5:bin-test_parameters-py2.5
          bin-test_py2.6:bin-test_parameters-py2.6
          bin-test_win-py2.5:bin-test_parameters-win-py2.5
          bin-test_win-py2.6:bin-test_parameters-win-py2.6
          bin-test-ztk-py2.5:bin-test-ztk_parameters-py2.5
          bin-test-ztk-py2.6:bin-test-ztk_parameters-py2.6
          bin-test-ztk_win-py2.5:bin-test-ztk_parameters-win-py2.5
          bin-test-ztk_win-py2.6:bin-test-ztk_parameters-win-py2.6
          bin-test-grok:bin-test-grok_parameters
          bin-test-grok_win-py2.6:bin-test-grok_parameters-win-py2.6


[bin-test_parameters]
repos = 
    http://svn.zope.org/repos/main/grok/trunk
    http://svn.zope.org/repos/main/grokcore.annotation/trunk
    http://svn.zope.org/repos/main/grokcore.component/trunk
    http://svn.zope.org/repos/main/grokcore.component/branches/1.x
    http://svn.zope.org/repos/main/grokcore.formlib/trunk
    http://svn.zope.org/repos/main/grokcore.security/trunk
    http://svn.zope.org/repos/main/grokcore.security/branches/1.2
    http://svn.zope.org/repos/main/grokcore.site/trunk
    http://svn.zope.org/repos/main/grokcore.startup/trunk
    http://svn.zope.org/repos/main/grokcore.view/trunk
    http://svn.zope.org/repos/main/grokcore.view/branches/1.13
    http://svn.zope.org/repos/main/grokcore.viewlet/trunk
    http://svn.zope.org/repos/main/grokui.admin/trunk
    http://svn.zope.org/repos/main/martian/trunk
    http://svn.zope.org/repos/main/martian/branches/0.11
    http://svn.zope.org/repos/main/grokproject/trunk
    http://svn.zope.org/repos/main/grokui.introspector/trunk
    http://svn.zope.org/repos/main/megrok.strictrequire/trunk

# Test grok 1.0 branch on 2.5 only.
[bin-test_parameters-py2.5]
<= project-py2.5-defaults
repos = http://svn.zope.org/repos/main/grok/branches/1.0

[bin-test_parameters-win-py2.5]
<= project-win-py2.5-defaults
repos = ${bin-test_parameters-py2.5:repos}

# Don't test usercrontab on windows.
[bin-test_parameters-py2.6]
repos = ${bin-test_parameters:repos}
        http://svn.zope.org/repos/main/z3c.recipe.usercrontab/trunk

[bin-test_parameters-win-py2.6]
<= project-win-py2.6-defaults
repos = ${bin-test_parameters:repos}


[bin-test-ztk_parameters-py2.5]
<= project-py2.5-defaults
repos = ${bin-test-ztk_parameters-py2.6:repos}
test = ${bin-test-ztk_parameters-py2.6:test}

[bin-test-ztk_parameters-py2.6]
repos = http://svn.zope.org/repos/main/zopetoolkit/trunk
test = bin/test-ztk

[bin-test-ztk_parameters-win-py2.5]
<= project-win-py2.5-defaults
repos = ${bin-test-ztk_parameters-win-py2.6:repos}
test = ${bin-test-ztk_parameters-win-py2.6:test}

[bin-test-ztk_parameters-win-py2.6]
<= project-win-py2.6-defaults
repos = ${bin-test-ztk_parameters-py2.6:repos}
test = bin\test-ztk


[bin-test-grok_parameters]
repos = http://svn.zope.org/repos/main/groktoolkit/trunk
test = bin/test-grok
mailto = zope-tests@zope.org

[bin-test-grok_parameters-win-py2.6]
<= project-win-py2.6-defaults
repos = ${bin-test-grok_parameters:repos}
test = bin\test-grok
mailto = ${bin-test-grok_parameters:mailto}


[reboot-slave-macro]
times = @reboot
command = ${buildout:bin-directory}/slave-$${:__name__} start

[reboot-slaves]
recipe = zc.recipe.macro
result-recipe = z3c.recipe.usercrontab
macro = reboot-slave-macro
targets = ubuntu32
          ubuntu64
          osx
 
[reboot-master]
recipe = z3c.recipe.usercrontab
times = @reboot
command = ${buildout:bin-directory}/master start

